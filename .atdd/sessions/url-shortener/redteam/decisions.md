# 사용자 결정 로그

## 개요
이 문서는 Red Team Critique 결과에 대한 사용자 결정을 기록합니다.

---

## 결정 옵션

| 결정 | 의미 | 다음 단계 |
|------|------|-----------|
| **ACCEPT (v)** | 비평 수용 | ADR에 반영 |
| **ACCEPT (~)** | 비평 수용 (수정) | 제안 대신 사용자 대안 적용 |
| **REJECT (x)** | 비평 거부 | 거부 사유 기록 |
| **DEFER** | 나중에 처리 | backlog.md에 추가 |

---

## ADR-001 Critique 결정

### [SEC-1] 악성 URL 단축 방지 메커니즘 부재 (HIGH)
- **결정**: ✅ ACCEPT
- **이유**: 법적/평판 리스크 방지
- **조치**: URL 패턴 검증, 신고/차단 기능 추가

### [SEC-2] 해시 충돌을 통한 URL 하이재킹 가능성 (MEDIUM)
- **결정**: ✅ ACCEPT
- **이유**: 보안 강화를 위해 충돌 방지 필요
- **조치**: 해시 길이 10바이트로 증가, 충돌 시 원본 URL 검증

### [PERF-1] 충돌 빈발 시 성능 저하 (MEDIUM)
- **결정**: ❌ REJECT
- **이유**: 1억 개 URL 도달 전까지는 문제되지 않음
- **사유**: DAU 10만 기준으로 충돌률 미미

### [SCALE-1] Sequence 관리의 분산 환경 복잡도 (MEDIUM)
- **결정**: ✅ ACCEPT
- **이유**: 분산 환경 대응 필요
- **조치**: Sequence 대신 타임스탬프 또는 서버 ID 결합 방식으로 변경

### [BIZ-1] 커스텀 별칭(Vanity URL) 미지원 (LOW)
- **결정**: ❌ REJECT
- **이유**: MVP 범위 초과
- **사유**: 추후 로드맵에서 검토

### [BIZ-2] "같은 URL = 같은 단축" 정책의 비즈니스 한계 (LOW)
- **결정**: ✅ ACCEPT
- **이유**: 캠페인 추적 기능 필요
- **조치**: UTM 파라미터가 다르면 다른 단축 URL 생성 정책 추가

### [REL-1] 충돌 해결 중 DB 장애 시 처리 미정의 (MEDIUM)
- **결정**: ✅ ACCEPT (수정)
- **이유**: DB 의존성 제거
- **조치**: Sequence 대신 timestamp 방식으로 변경하여 DB 장애 영향 최소화

---

## ADR-002 Critique 결정

### [SEC-1] Redis 접근 보안 미명시 (MEDIUM)
- **결정**: ❌ REJECT
- **이유**: 인프라 수준 설정, ADR 범위 밖
- **사유**: 배포 설정에서 별도 처리

### [SEC-2] 캐시 오염(Cache Poisoning) 가능성 (LOW)
- **결정**: ❌ REJECT
- **이유**: 현재 설계에서 URL 변경 불가하므로 낮은 위험
- **사유**: 불필요한 복잡도 추가

### [PERF-1] Cache Miss 시 P99 지연 시간 (MEDIUM)
- **결정**: ✅ ACCEPT (수정)
- **이유**: 초기 성능 개선
- **조치**: 서버 켜질 때 cache warm-up 전략만 사용

### [PERF-2] 캐시 스탬피드 완화 전략 구체화 필요 (LOW)
- **결정**: ❌ REJECT
- **이유**: MVP 단계에서 과도한 엔지니어링
- **사유**: 트래픽 급증 시 별도 대응

### [SCALE-1] Redis 단일 인스턴스 SPOF (MEDIUM)
- **결정**: ❌ REJECT
- **이유**: DAU 10만 규모에서는 단일 인스턴스로 충분
- **사유**: DAU 50만 시점에 재검토

### [SCALE-2] 캐시 메모리 용량 계획 부재 (LOW)
- **결정**: ✅ ACCEPT
- **이유**: 운영 안정성 확보
- **조치**: Redis maxmemory 및 eviction 정책(allkeys-lru) 설정

### [REL-1] Cache Warm-up 구체적 절차 미정의 (LOW)
- **결정**: ✅ ACCEPT (수정)
- **이유**: 복구 후 성능 유지
- **조치**: 조회수 기반 warm-up 전략 사용 (상위 1000개 URL)

---

## ADR-003 Critique 결정

### [SEC-1] 조회수 조작(Injection) 가능성 (LOW)
- **결정**: ✅ ACCEPT (수정)
- **이유**: 통계 신뢰도 확보
- **조치**: IP 기반 중복 카운트 방지 사용

### [PERF-1] 대량 Bulk UPDATE 성능 이슈 (MEDIUM)
- **결정**: ✅ ACCEPT (수정)
- **이유**: DB 부하 방지
- **조치**: JDBC Batch Update 사용

### [PERF-2] Redis 전체 스캔 부하 (MEDIUM)
- **결정**: ✅ ACCEPT (수정)
- **이유**: Redis 블로킹 방지
- **조치**: SCAN 방식 사용 (커서 기반)

### [SCALE-1] 동기화 스케줄러 SPOF (HIGH)
- **결정**: ❌ REJECT (수정)
- **이유**: MVP 단계에서 1시간치 데이터 유실 감수
- **사유**: 실패 시 fail log 정도 수집으로 끝. 향후 DAU 증가 시 ShedLock 도입

### [SCALE-2] Redis 조회수 키 무한 증가 (MEDIUM)
- **결정**: ✅ ACCEPT (수정)
- **이유**: 메모리 관리
- **조치**: 조회수 키에 TTL 설정하여 자동 삭제

### [MAINT-1] 통계 정확도 검증 방법 부재 (LOW)
- **결정**: ✅ ACCEPT
- **이유**: 데이터 정합성 모니터링
- **조치**: 일일 정합성 검사 배치 추가

### [BIZ-1] "실제 조회수와 다를 수 있음" 안내의 UX 영향 (LOW)
- **결정**: ✅ ACCEPT (수정)
- **이유**: UX 개선
- **조치**: 동기화 주기를 10분으로 단축

### [REL-1] Circuit Breaker 상태 복구 후 데이터 동기화 (MEDIUM)
- **결정**: ✅ ACCEPT (수정)
- **이유**: 장애 복구 후 정합성 유지
- **조치**: Redis cache 날리고 warm-up 전략 사용

---

## 결정 요약

| ADR | ACCEPT | ACCEPT(수정) | REJECT | 총계 |
|-----|--------|--------------|--------|------|
| ADR-001 | 3 | 1 | 3 | 7 |
| ADR-002 | 1 | 2 | 4 | 7 |
| ADR-003 | 1 | 5 | 2 | 8 |
| **총계** | **5** | **8** | **9** | **22** |

### ACCEPT 항목 (ADR 수정 필요)
- ADR-001: SEC-1, SEC-2, SCALE-1, BIZ-2, REL-1
- ADR-002: SCALE-2, PERF-1(수정), REL-1(수정)
- ADR-003: SEC-1(수정), PERF-1(수정), PERF-2(수정), SCALE-2(수정), MAINT-1, BIZ-1(수정), REL-1(수정)
