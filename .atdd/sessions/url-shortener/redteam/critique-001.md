# Critique Report: ADR-001 (단축 URL 생성 알고리즘)

## 개요
- **ADR**: ADR-001. 단축 URL 생성 알고리즘 선택
- **검토 일시**: 2026-02-27
- **전체 위험도**: MEDIUM

---

## 이슈 목록

### [SEC-1] 악성 URL 단축 방지 메커니즘 부재 v
- **관점**: Security
- **심각도**: HIGH
- **설명**: 원본 URL에 대한 검증이나 블랙리스트 체크가 없어, 피싱/멀웨어 사이트의 단축 URL 생성이 가능함
- **영향**: 서비스가 악의적 목적으로 악용될 수 있으며, 법적/평판적 리스크 존재
- **제안**:
  - URL 패턴 검증 (프로토콜, 도메인 형식)
  - Google Safe Browsing API 등 연동한 악성 URL 탐지
  - 신고 메커니즘 및 관리자 차단 기능

### [SEC-2] 해시 충돌을 통한 URL 하이재킹 가능성 v
- **관점**: Security
- **심각도**: MEDIUM
- **설명**: 8바이트 해시는 생일 역설에 의해 약 2^32(43억)개 URL에서 50% 충돌 확률. 공격자가 의도적으로 충돌을 유도할 수 있음
- **영향**: 다른 사용자의 단축 URL이 덮어씌워지거나, 의도치 않은 리다이렉트 발생
- **제안**:
  - 해시 길이를 10바이트 이상으로 증가 고려 (2^64까지 확장)
  - 충돌 감지 시 원본 URL 일치 여부 확인 후 Sequence 부여

### [PERF-1] 충돌 빈발 시 성능 저하 x
- **관점**: Performance
- **심각도**: MEDIUM
- **설명**: URL 수가 1억 개 이상이면 충돌 확률이 급증하며, 재시도 루프로 인해 생성 응답시간이 500ms를 초과할 수 있음
- **영향**: 트래픽 급증 시 서비스 응답성 저하
- **제안**:
  - 충돌 시 최대 재시도 횟수 제한 (예: 3회)
  - 모니터링 지표에 충돌률 추가

### [SCALE-1] Sequence 관리의 분산 환경 복잡도 v
- **관점**: Scalability
- **심각도**: MEDIUM
- **설명**: 충돌 해결을 위한 Sequence 관리가 분산 환경에서 복잡해질 수 있음. DB 기반 Sequence 사용 시 병목 가능성
- **영향**: 수평 확장 시 성능 저하
- **제안**:
  - Sequence 대신 타임스탬프나 서버 ID 결합 방식 고려
  - 또는 충돌 시에만 Sequence 조회 (지연 로딩)

### [BIZ-1] 커스텀 별칭(Vanity URL) 미지원 x
- **관점**: Business
- **심각도**: LOW
- **설명**: 사용자가 원하는 키워드를 단축 URL에 포함할 수 없음 (예: bit.ly/my-promo)
- **영향**: 마케팅 활용성 제한, 경쟁사 대비 기능 부족
- **제안**: MVP 이후 커스텀 별칭 기능 로드맵에 추가

### [BIZ-2] "같은 URL = 같은 단축" 정책의 비즈니스 한계 v
- **관점**: Business
- **심각도**: LOW
- **설명**: 동일 URL에 대해 항상 같은 단축 URL을 반환하면, 사용자별/캠페인별 추적이 불가능함
- **영향**: 마케팅 캠페인 효과 측정 어려움
- **제안**:
  - 선택적으로 "고유 단축 URL 생성" 옵션 제공
  - UTM 파라미터가 다르면 다른 단축 URL 생성 정책 검토

### [REL-1] 충돌 해결 중 DB 장애 시 처리 미정의 ~ sequence timestamp 로 변경
- **관점**: Reliability
- **심각도**: MEDIUM
- **설명**: 충돌 감지 후 Sequence 생성 중 DB가 장애나면, 요청이 실패하거나 무한 대기 상태가 될 수 있음
- **영향**: 서비스 가용성 저하
- **제안**:
  - 타임아웃 설정 및 fallback 메커니즘 정의
  - 재시도 로직에 Exponential Backoff 적용

---

## 요약

| 관점 | 이슈 수 | HIGH | MEDIUM | LOW |
|------|---------|------|--------|-----|
| Security | 2 | 1 | 1 | 0 |
| Performance | 1 | 0 | 1 | 0 |
| Scalability | 1 | 0 | 1 | 0 |
| Maintainability | 0 | 0 | 0 | 0 |
| Business | 2 | 0 | 0 | 2 |
| Reliability | 1 | 0 | 1 | 0 |
| **Total** | **7** | **1** | **4** | **2** |

---

## 권장 사항

1. **[긴급] SEC-1 해결**: 악성 URL 차단 메커니즘을 MVP에 포함하거나, 최소한 신고/차단 기능을 준비
2. **[권장] SEC-2/PERF-1 해결**: 해시 길이를 10바이트로 증가하여 충돌 확률 대폭 감소
3. **[고려] BIZ-1/BIZ-2**: MVP 이후 로드맵에 커스텀 별칭 및 캠페인 추적 기능 추가

---

## ADR 수정 제안

### 추가할 섹션: Security Considerations

```markdown
## Security Considerations

### 악성 URL 방지
- URL 프로토콜 제한 (http, https만 허용)
- 향후 Google Safe Browsing API 연동 검토
- 관리자용 URL 차단 기능 필요

### 해시 안전성
- 8바이트 → 10바이트로 증가 검토 (충돌 확률 2^32 → 2^64)
- 충돌 시 원본 URL 검증 후 Sequence 부여
```
